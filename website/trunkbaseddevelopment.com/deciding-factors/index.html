<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Deciding factors - Trunk Based Development</title>
    <meta name="generator" content="Hugo 0.85.0" />

    
    <meta name="description" content="A portal on this practice">
    
    <link rel="canonical" href="index.html">
    
    <meta name="author" content="paul-hammant">
    

    <meta property="og:url" content="https://trunkbaseddevelopment.com/deciding-factors/">
    <meta property="og:title" content="Trunk Based Development">
    <meta property="og:image" content="https://trunkbaseddevelopment.com/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Trunk Based Development">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('../fonts/icon.eot');
        src: url('../fonts/icon.eot')
               format('embedded-opentype'),
             url('../fonts/icon.woff')
               format('woff'),
             url('../fonts/icon.ttf')
               format('truetype'),
             url('../fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="../stylesheets/application.css">
    <link rel="stylesheet" href="../stylesheets/temporary.css">
    <link rel="stylesheet" href="../stylesheets/palettes.css">
    <link rel="stylesheet" href="../stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="../javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-light-blue">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Trunk Based Development: Deciding factors
      </div>
    </div>

    

        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <div class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../images/logo.png">
        </div>
      
      <div class="name">
        <strong>Trunk Based Development</strong>
      </div>
    </div>
  </div>

  <div class="scrollable">
    <div class="wrapper">
      <hr>

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Introduction" href="../index.html">
	
	Introduction
</a>



  
</li>



<li>
  
    



<a  title="Context" href="../context/index.html">
	
	Context
</a>



  
</li>



<li>
  
    



<a  title="Five-minute overview" href="../5-min-overview/index.html">
	
	Five-minute overview
</a>



  
</li>



<li>
  
    



<a class="current" title="Deciding factors" href="index.html">
	
	Deciding factors
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Version control system features" href="../vcs-features/index.html">
	
	Version control system features
</a>



  
</li>



<li>
  
    



<a  title="Version control system choices" href="../vcs-choices/index.html">
	
	Version control system choices
</a>



  
</li>



<li>
  
    



<a  title="Feature flags" href="../feature-flags/index.html">
	
	Feature flags
</a>



  
</li>



<li>
  
    



<a  title="Branch by Abstraction" href="../branch-by-abstraction/index.html">
	
	Branch by Abstraction
</a>



  
</li>



<li>
  
    



<a  title="Branch for release" href="../branch-for-release/index.html">
	
	Branch for release
</a>



  
</li>



<li>
  
    



<a  title="Release from trunk" href="../release-from-trunk/index.html">
	
	Release from trunk
</a>



  
</li>



<li>
  
    



<a  title="Styles and Trade-offs" href="../styles/index.html">
	
	Styles and Trade-offs
</a>



  
</li>



<li>
  
    



<a  title="Continuous Integration (CI)" href="../continuous-integration/index.html">
	
	Continuous Integration (CI)
</a>



  
</li>



<li>
  
    



<a  title="Committing straight to the trunk" href="../committing-straight-to-the-trunk/index.html">
	
	Committing straight to the trunk
</a>



  
</li>



<li>
  
    



<a  title="Short Lived Feature Branches" href="../short-lived-feature-branches/index.html">
	
	Short Lived Feature Branches
</a>



  
</li>



<li>
  
    



<a  title="Continuous Code Review" href="../continuous-review/index.html">
	
	Continuous Code Review
</a>



  
</li>



<li>
  
    



<a  title="Continuous Delivery (CD)" href="../continuous-delivery/index.html">
	
	Continuous Delivery (CD)
</a>



  
</li>



<li>
  
    



<a  title="Concurrent development of consecutive releases" href="../concurrent-development-of-consecutive-releases/index.html">
	
	Concurrent development of consecutive releases
</a>



  
</li>



<li>
  
    



<a  title="Application strangulation" href="../strangulation/index.html">
	
	Application strangulation
</a>



  
</li>



<li>
  
    



<a  title="Observed habits" href="../observed-habits/index.html">
	
	Observed habits
</a>



  
</li>



<li>
  
    



<a  title="You&#39;re doing it wrong" href="../youre-doing-it-wrong/index.html">
	
	You&#39;re doing it wrong
</a>



  
</li>



<li>
  
    



<a  title="Alternative branching models" href="../alternative-branching-models/index.html">
	
	Alternative branching models
</a>



  
</li>



<li>
  
    



<a  title="Monorepos" href="../monorepos/index.html">
	
	Monorepos
</a>



  
</li>



<li>
  
    



<a  title="Expanding Contracting Monorepos" href="../expanding-contracting-monorepos/index.html">
	
	Expanding Contracting Monorepos
</a>



  
</li>



<li>
  
    



<a  title="Game Changers" href="../game-changers/index.html">
	
	Game Changers
</a>



  
</li>



<li>
  
    



<a  title="Publications" href="../publications/index.html">
	
	Publications
</a>



  
</li>



<li>
  
    



<a  title="Book on this topic" href="../book/index.html">
	
	Book on this topic
</a>



  
</li>



<li>
  
    



<a  title="Key to branch diagrams" href="../key/index.html">
	
	Key to branch diagrams
</a>



  
</li>



<li>
  
    



<a  title="Contributions" href="../contributions/index.html">
	
	Contributions
</a>



  
</li>


        </ul>
        

        
        <hr>

        <ul>

          <li>
            <a href="https://github.com/paul-hammant/tbd" target="_blank" title="See GitHub Repo">
              Site Source on Github
            </a>
          </li>

          <li>
            <a href="https://github.com/paul-hammant/tbd/commit/7f6c170e3760e5ae5cb49fca37b73cfea475581d" target="_blank">
              SHA-1 Published: 7f6c170e3760e5ae5cb49fca37b73cfea475581d
            </a>
          </li>
          </li>
<iframe id="buy" width='160' height='400' src='https://leanpub.com/trunk-based-development/embed' frameborder='0' allowtransparency='true'></iframe>
          <li>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1 style="color: white; padding: 32px 20px 72px; background-image:url(../images/LogoSlim.png); background-repeat: no-repeat; background-size: 100% auto"><span style="background-color: #5677fc">Deciding factors </span></h1>

			<h2 id="release-cadence">Release cadence</h2>
<p>There are many factors that put pressure on the team to lengthen the interval between releases. Here are some.</p>
<h3 id="iteration-length">Iteration length</h3>
<p>Different Agile teams focus on different iteration lengths. Some teams work at three-week iterations, some two,
and some one. Some teams do not have an iteration at all - particularly teams doing Continuous Delivery.</p>
<p>If you are on a four week, or more iteration length, and each of those four weeks varies with proximity to the
release and cannot change that you may be in a bind. You may be able to follow the tenets of Trunk-Based Development,
benefit from a Continuous Integration daemon (as all branching models can), but you are not going to be able to
get all the way to Continuous Delivery (or Continuous Deployment).</p>
<h3 id="waterfall">Waterfall</h3>
<p>This one is easy. If you are doing waterfall, you are not close at all to the &ldquo;do not break the build&rdquo; mantra required
to do Trunk-Based Development. Consider a short-iteration Agile methodology like Extreme Programming.</p>
<h3 id="story-size">Story size</h3>
<p>Trunk-Based Development needs you to have small stories/tasks. Optimal is you starting work on a change, should only be a matter
of hours before completing and pushing it forward for code review. Longer than a couple of days, and there is going to be
pressure to group a bunch of developers on a non-trunk branch and merge back later. Or worse, have developers make
branches/forks from your in-progress branch. Or worse still, take intermediate merges from your branch, despite your
change being incomplete.</p>
<p>Generally speaking, the whole development team should do whatever it can to break stories/tasks into smaller stories/tasks.
In Agile, there is an INVEST mnemonic<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://en.wikipedia.org/wiki/INVEST_%28mnemonic%29"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="../images/ext.png" alt=""></a></span> that aids in the splitting
up of stories.</p>
<h3 id="build-times">Build times</h3>
<p>Keeping build times short is important in that it directly drives the number of commits a developer can do in a day.
If the build time is a couple of minutes, developers are likely to keep a high pace. If the build time is 30 minutes or
worse, developers change pace to match only a couple of commits a day and drop their throughput.</p>
<h2 id="vcs-technology-choice">VCS Technology Choice</h2>
<p>Your VCS/source-control technology choice should facilitate update/pull/sync from the team&rsquo;s trunk many times
a day. The elapsed time for the update/pull/sync should be less than three seconds for the situation where you
already had latest of everything. It should be no more than fifteen seconds the case of the shared trunk being ahead
of you.</p>
<p>Older versions of ClearCase and PVCS Dimensions would be 30 minutes for the former and 45 minutes for the latter.
Double that if two team-mates were simultaneously trying to do the update/pull/sync operation. In that configuration, it
was completely impossible for teams to practice Trunk-Based Development.</p>
<h3 id="binaries-in-the-repo">Binaries in the Repo?</h3>
<p>Depending on how many and how often they update, some SCM/VCS/source-control technologies are better than others.
Perforce can handle terabytes of binaries and textual source. Subversion aims to. Git can only do large binaries  if
configured in Git-LFS mode<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://git-lfs.github.com/"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="../images/ext.png" alt=""></a></span>.</p>
<h3 id="repo-size">Repo size?</h3>
<p>It is suggested that Git and Mercurial really should not have a history (ignoring Git-LFS) that exceeds 1GB. There are field reports of clones being
many times bigger than that and still working, but the development team suggests 1GB as the top limit. In order to use Git
and push through that ceiling yearly, you might be in a situation where you have to keep archiving a repository, and starting
a new one with no history to have more head room. Archiving might look like renaming the repository in GitHub, and turning it
read-only so that all the history, issues, and code review comments are intact. Simpler clone-rationalization strategies might
include recommending a &ldquo;&ndash;shallow-since&rdquo; date on cloning, or leveraging more recent partial clone capabilities to clone the full repo
commit history without getting historical blobs until they are needed.</p>
<h3 id="peak-commit-frequency">Peak commit frequency</h3>
<p>In &ldquo;pure&rdquo; Git, if a colleague beat you to a commit/push on a branch (their code-review and automated CI passed) when you
thought you were going to push, Git will inform you that you have to pull first. You pull, and you resolve your merge clashes
(hopefully none), and then push again. On highly-active repos, you might struggle to find a window open long enough to push in
this way without encountering the same problem. This is known as the &ldquo;race to push&rdquo;.</p>
<p>Fork-based &ldquo;pull requests&rdquo; and similar branch-based &ldquo;merge requests&rdquo; in hosted git services solve this to a degree, with robots
keeping pull-request branches abreast of <code>origin:master</code> automatically as long as no conflicts arise.</p>
<p>Even with Pull Requests, however, very high commit frequencies to the shared repo means contention and an artificial
serialization. Microsoft acknowledged this as one
of the motivations to their Git Virtual File System (<del>GitVFS</del> <del>GVFS</del> VFS for Git<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://vfsforgit.org/"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="../images/ext.png" alt=""></a></span>).</p>
<div class="admonition quote">
<p class="admonition-title">Git has critical serialization points that will cause a queue to back up badly</p>
<span style="padding-left: 15px"><!-- raw HTML omitted -->â€” Brian Harry<!-- raw HTML omitted --><!-- raw HTML omitted -->
<!-- raw HTML omitted -->Refer to Brian&rsquo;s &ldquo;More on GVFS&rdquo; blog entry<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></span>
</div>
<br/>
<p>We&rsquo;re sure that within a few years, Git will be able to handle huge scale too. Whether with the Microsoft technologies, or
something else.</p>
<h2 id="conways-law">Conway&rsquo;s Law</h2>
<p>The organization creates applications and services that reflect the organization&rsquo;s own structure<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://en.wikipedia.org/wiki/Conway%27s_law"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="../images/ext.png" alt=""></a></span>.
If your organization feels like this, and a Monorepo does not feel right, then MicroServices could be the direction for you.</p>
<h2 id="database-migrations">Database migrations</h2>
<p>In order to manage database schemas in a Trunk-Based Development way you will need to find a way to handle table-shape changes under source control, and even
manage existing data where new/changed columns have happened. Pramod Sadlage and Scott Amber&rsquo;s book
&ldquo;Refactoring Databases: Evolutionary Database Design&quot;<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://www.amazon.com/Refactoring-Databases-Evolutionary-paperback-Addison-Wesley/dp/0321774515"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="../images/ext.png" alt=""></a></span>
goes into that much more, as does the <a href="../continuous-delivery/index.html">Continuous Delivery</a> book.</p>
<h2 id="shared-code">Shared code</h2>
<p>Trunk-Based Development teams typically have common code ownership rules around contributions to different parts
of the source tree. If they do not have a fully egalitarian system, they have objective rules for contributions to the tree.
Rules that focus on standards and come with a promise of a prioritized and fair code review. Trunk-Based Development
teams might have fine-grained write permissions for directories within the trunk, but <strong>never</strong> have any impediment
to reading files in the trunk - everyone can see everything.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->


			<aside class="copyright" role="note">
				&copy; 2017-2020: <a href="https://devops.paulhammant.com/">Paul Hammant</a>. With Contributions <a href="../contributions/index.html">from friends</a>.
				Site built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				with
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme,
				via <a href="https://netlify.com/">Netlify</a>. &nbsp;
				<a href="https://github.com/paul-hammant/tbd/edit/master/content//_index.md">Contribute to this page</a>

			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="../vcs-features/index.html" title="Version control system features">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Version control system features
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="../5-min-overview/index.html" title="Five-minute overview">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Five-minute overview
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/trunkbaseddevelopment.com\/';
      var repo_id  = 'paul-hammant\/tbd';
    
    </script>

    <script src="../javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }

      var showHideRefs = document.getElementById("showHideRefs");
      var refsElsewhereH1;
      var refsTable;
      if (showHideRefs) {
          refsElsewhereH1 = document.getElementById("references-elsewhere");
      }
      if (showHideRefs) {
          refsTable = refsElsewhereH1.nextElementSibling.nextElementSibling;
          hideRefs();
      }

      function hideRefs() {
          refsTable.style.display = "none";
          showHideRefs.innerHTML = "show references";
      }

      function toggleRefs() {
          if(refsTable.style.display == "block") {
              hideRefs();
          }
          else {
              refsTable.style.display = "block";
              showHideRefs.innerHTML = "hide references";
          }
      }


    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-24415524-3', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

