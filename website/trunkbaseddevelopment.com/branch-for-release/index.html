<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Branch for release - Trunk Based Development</title>
    <meta name="generator" content="Hugo 0.85.0" />

    
    <meta name="description" content="A portal on this practice">
    
    <link rel="canonical" href="index.html">
    
    <meta name="author" content="paul-hammant">
    

    <meta property="og:url" content="https://trunkbaseddevelopment.com/branch-for-release/">
    <meta property="og:title" content="Trunk Based Development">
    <meta property="og:image" content="https://trunkbaseddevelopment.com/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Trunk Based Development">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('../fonts/icon.eot');
        src: url('../fonts/icon.eot')
               format('embedded-opentype'),
             url('../fonts/icon.woff')
               format('woff'),
             url('../fonts/icon.ttf')
               format('truetype'),
             url('../fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="../stylesheets/application.css">
    <link rel="stylesheet" href="../stylesheets/temporary.css">
    <link rel="stylesheet" href="../stylesheets/palettes.css">
    <link rel="stylesheet" href="../stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="../javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-light-blue">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Trunk Based Development: Branch for release
      </div>
    </div>

    

        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <div class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../images/logo.png">
        </div>
      
      <div class="name">
        <strong>Trunk Based Development</strong>
      </div>
    </div>
  </div>

  <div class="scrollable">
    <div class="wrapper">
      <hr>

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Introduction" href="../index.html">
	
	Introduction
</a>



  
</li>



<li>
  
    



<a  title="Context" href="../context/index.html">
	
	Context
</a>



  
</li>



<li>
  
    



<a  title="Five-minute overview" href="../5-min-overview/index.html">
	
	Five-minute overview
</a>



  
</li>



<li>
  
    



<a  title="Deciding factors" href="../deciding-factors/index.html">
	
	Deciding factors
</a>



  
</li>



<li>
  
    



<a  title="Version control system features" href="../vcs-features/index.html">
	
	Version control system features
</a>



  
</li>



<li>
  
    



<a  title="Version control system choices" href="../vcs-choices/index.html">
	
	Version control system choices
</a>



  
</li>



<li>
  
    



<a  title="Feature flags" href="../feature-flags/index.html">
	
	Feature flags
</a>



  
</li>



<li>
  
    



<a  title="Branch by Abstraction" href="../branch-by-abstraction/index.html">
	
	Branch by Abstraction
</a>



  
</li>



<li>
  
    



<a class="current" title="Branch for release" href="index.html">
	
	Branch for release
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Release from trunk" href="../release-from-trunk/index.html">
	
	Release from trunk
</a>



  
</li>



<li>
  
    



<a  title="Styles and Trade-offs" href="../styles/index.html">
	
	Styles and Trade-offs
</a>



  
</li>



<li>
  
    



<a  title="Continuous Integration (CI)" href="../continuous-integration/index.html">
	
	Continuous Integration (CI)
</a>



  
</li>



<li>
  
    



<a  title="Committing straight to the trunk" href="../committing-straight-to-the-trunk/index.html">
	
	Committing straight to the trunk
</a>



  
</li>



<li>
  
    



<a  title="Short Lived Feature Branches" href="../short-lived-feature-branches/index.html">
	
	Short Lived Feature Branches
</a>



  
</li>



<li>
  
    



<a  title="Continuous Code Review" href="../continuous-review/index.html">
	
	Continuous Code Review
</a>



  
</li>



<li>
  
    



<a  title="Continuous Delivery (CD)" href="../continuous-delivery/index.html">
	
	Continuous Delivery (CD)
</a>



  
</li>



<li>
  
    



<a  title="Concurrent development of consecutive releases" href="../concurrent-development-of-consecutive-releases/index.html">
	
	Concurrent development of consecutive releases
</a>



  
</li>



<li>
  
    



<a  title="Application strangulation" href="../strangulation/index.html">
	
	Application strangulation
</a>



  
</li>



<li>
  
    



<a  title="Observed habits" href="../observed-habits/index.html">
	
	Observed habits
</a>



  
</li>



<li>
  
    



<a  title="You&#39;re doing it wrong" href="../youre-doing-it-wrong/index.html">
	
	You&#39;re doing it wrong
</a>



  
</li>



<li>
  
    



<a  title="Alternative branching models" href="../alternative-branching-models/index.html">
	
	Alternative branching models
</a>



  
</li>



<li>
  
    



<a  title="Monorepos" href="../monorepos/index.html">
	
	Monorepos
</a>



  
</li>



<li>
  
    



<a  title="Expanding Contracting Monorepos" href="../expanding-contracting-monorepos/index.html">
	
	Expanding Contracting Monorepos
</a>



  
</li>



<li>
  
    



<a  title="Game Changers" href="../game-changers/index.html">
	
	Game Changers
</a>



  
</li>



<li>
  
    



<a  title="Publications" href="../publications/index.html">
	
	Publications
</a>



  
</li>



<li>
  
    



<a  title="Book on this topic" href="../book/index.html">
	
	Book on this topic
</a>



  
</li>



<li>
  
    



<a  title="Key to branch diagrams" href="../key/index.html">
	
	Key to branch diagrams
</a>



  
</li>



<li>
  
    



<a  title="Contributions" href="../contributions/index.html">
	
	Contributions
</a>



  
</li>


        </ul>
        

        
        <hr>

        <ul>

          <li>
            <a href="https://github.com/paul-hammant/tbd" target="_blank" title="See GitHub Repo">
              Site Source on Github
            </a>
          </li>

          <li>
            <a href="https://github.com/paul-hammant/tbd/commit/7f6c170e3760e5ae5cb49fca37b73cfea475581d" target="_blank">
              SHA-1 Published: 7f6c170e3760e5ae5cb49fca37b73cfea475581d
            </a>
          </li>
          </li>
<iframe id="buy" width='160' height='400' src='https://leanpub.com/trunk-based-development/embed' frameborder='0' allowtransparency='true'></iframe>
          <li>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1 style="color: white; padding: 32px 20px 72px; background-image:url(../images/LogoSlim.png); background-repeat: no-repeat; background-size: 100% auto"><span style="background-color: #5677fc">Branch for release </span></h1>

			<div class="admonition quote">
<p class="admonition-title">Branch: only when necessary, on incompatible policy, late, and instead of freeze</p>
<span style="padding-left: 15px"><!-- raw HTML omitted -->â€” Laura Wingerd &amp; Christopher Seiwald<!-- raw HTML omitted --><!-- raw HTML omitted -->
<!-- raw HTML omitted -->(1998&rsquo;s High-Level SCM Best Practices white paper from Perforce)<!-- raw HTML omitted --></span>
</div>
<br/>
<p>If a team is pushing production releases monthly, then they are also going to have to push bug-fix releases
between planned releases. To facilitate that, it is common for Trunk-Based Development Teams to make a release
branch on a just in time basis - say a few days before the release. That becomes a stable place, given the developers
are still streaming their commits into the trunk at full speed.</p>
<p>The incompatible policy (ref Wingerd &amp; Seiwald above), that the release branch &ldquo;should not receive continued development work&rdquo;.</p>
<p><img src="branch_for_release.png" alt="">
(<a href="../key/index.html">key</a>)</p>
<p>^ Trunk, two and a half release branches, five releases (two planned, three unplanned), and two cherry-pick bug fixes</p>
<div class="admonition note">
<p class="admonition-title">CD teams do not do release branches</p>
<span>High throughput, <a href="../continuous-delivery/index.html">Continuous Delivery</a> teams can ignore this - if they had a lemon in production, they choose a
roll-forward strategy for solving it, meaning the fix for a bug is in the trunk, and the release to production is from the trunk.</span>
</div>
<h2 id="who-is-committing-where">Who is committing where?</h2>
<p>Developers are committing (green dots) at the highest throughput rate to the trunk, and do not slow up or freeze around a
branch-cut or with proximity to a release. Developers as a group are <strong>not</strong> commiting to the release branch (see below).</p>
<p><img src="branch_for_release2.png" alt="">
(<a href="../key/index.html">key</a>)</p>
<p>The branch cut itself is a commit. Subversion and Perforce would technically have a bigger commit here, but all
VCS systems in use today would count the commit as &lsquo;lightweight&rsquo; in terms of its impact on the history/storage,
and the time taken to create.</p>
<p>That red dot is an accidental build break that was fixed (somehow) soon after.</p>
<h2 id="late-creation-of-release-branches">Late creation of release branches</h2>
<p>Some teams <a href="../release-from-trunk/index.html">release from a tag on the trunk</a> and do not create a branch at that time. That in
itself is <strong>an alternate practice to this one, &ldquo;branch for release&rdquo;</strong>.</p>
<p>Those teams wait for a bug that needs fixing for a released, before creating a branch from the release tag (if they are
not going to just issue another release from the trunk).</p>
<p>Brad Appleton points out that many do not realize that branches can be created <strong>retroactively</strong>. That is taken advantage
of here in the case of bugs after &ldquo;release from a tag&rdquo;, or even changes for point releases.</p>
<h2 id="fix-production-bugs-on-trunk">Fix production bugs on Trunk</h2>
<p>The best practice for Trunk-Based Development teams is to reproduce the bug on the trunk, fix it there with a test,
watch that be verified by the CI server, then cherry-pick that to the release branch and wait for a CI server
focusing on the release branch to verify it there too. Yes, the CI pipeline that guards the trunk is going to
be duplicated to guard active release branches too.</p>
<div class="admonition warning">
<p class="admonition-title">A cherry-pick is not a regular merge</p>
<span>A cherry-pick merge takes a specific commit (or commits) and merges that to the destination branch. It skips
one or more commits that happened before it, but after the branch was cut. All VCS tools track which commits
have been merged and which ones not, so you can do more cherry picks later.</span>
</div>
<br/>
<h3 id="cherry-picks-from-the-trunk-to-branch-only">Cherry-picks from the trunk to branch ONLY</h3>
<p>You should not fix bugs on the release branch in the expectation of cherry-picking them back to the trunk.
Why? Well in case you forget to do that in the heat of the moment. Forgetting means a regression in production some
weeks later (and someone getting fired). It can happen if things are being fixed in the night by a tired developer who
wants to get back to bed.</p>
<p><img src="branch_for_release3.png" alt="">
(<a href="../key/index.html">key</a>)</p>
<p>This rule for Trunk Based Development remains difficult to accept, even within teams practicing everything else about
Trunk-Based Development. It takes just one regression though for a policy change to be made for the team.</p>
<p>Of course, sometimes you <strong>absolutely cannot</strong> reproduce the bug on trunk. In that case you have to do it the other way round, despite
everything mentioned above, but understand you have introduced risk of regression.</p>
<h3 id="googles-rachel-potvin-on-cherry-picks">Google&rsquo;s Rachel Potvin on Cherry picks</h3>
<p>In a talk at the @Scale conference in Sept 2015, &ldquo;Why Google Stores Billions of Lines of Code in a Single Repository&rdquo;,
there was a slide that depicts cherry-picks in a branch diagram:</p>
<p><img src="atscale.png" alt=""></p>
<p>The presenter, Rachel Potvin, said (14 mins in):</p>
<p>&ldquo;So at Google we do what&rsquo;s called Trunk-Based Development. I should note that it is the combination of Trunk-Based Development with a centralized repository that really defines the monolithic model of source code management. So
what Trunk-Based Development means for us that typically Piper users all work from HEAD or a single copy of the most recent version of the codebase. When developers commit to Piper their changes are immediately visible and usable by other engineers. Branching for development at Google is exceedingly rare and Trunk-Based Development is beneficial partly because you avoid the painful merges that often occur when you need to reconcile long lived branches.  Branches however are used for releases. <strong>So a release branch is typically a snapshot from trunk with an
optional number of cherry picks that are developed on trunk and then pulled into the branch</strong>.&rdquo;</p>
<p>We&rsquo;ve bolded the cherry-pick bit ourselves.  Readers with beady eyes will note that Rachel alludes to
dev branches other than trunk for &lsquo;rare&rsquo; reasons. We may cheekily suggest that Google should learn a little more about <a href="../branch-by-abstraction/index.html">Branch by Abstraction</a>.</p>
<h3 id="merge-meister-role">Merge Meister role</h3>
<p>The process of merging commits from trunk to the release branch using &lsquo;cherry pick&rsquo; is a role for a single developer
in a team. Or dev pair, if you are doing Extreme Programming. Even then, it is a part time activity. The dev or pair
probably needs to police a list of rules before doing the cherry pick. Rules like which business representative
signed off on the merge. Perhaps the role should also rotate each day.</p>
<p>Some teams update a wiki to audit what made it to the release branch after branch cut, and some use ticket system as
this by its nature interrupting and requiring of an audit trail of approvals.</p>
<h2 id="patch-releases">Patch releases</h2>
<p>It could be that your team has pushed a release out from a release branch, and now has a bug to remediate in
production. If the release cadence suits it, a cherry-pick of a bug fix from the trunk to the release branch
and a point release from the same branch is fine.</p>
<h3 id="tag-instead-of-branch">Tag instead of branch</h3>
<p>Releasing from a tag on the trunk is a decent optimization for many teams, if possible. The tag could be numbered for
the release (say v1.1.1), and the branch can be avoided completely. Perhaps if there is a bug in production and a branch
is retroactively created from that tag, and the patch release (see above) can happen from there.</p>
<h2 id="release-branch-deletion">Release branch deletion</h2>
<p>Release branches are deleted some time after release activity from them ceases. Not immediately, but when it is clear release is no longer in production. Release branches are NOT merged back into trunk.
That is usually when releases from succeeding release branches have gone live. This is a
harmless tidying activity - branches can be undeleted again easily enough in all VCS choices. In git, a tag needs to be created from the released commit before deleting the release branch, since dangling commits will be garbage collected.</p>
<h1 id="references-elsewhere">References elsewhere</h1>
<p><!-- raw HTML omitted -->show references<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->


			<aside class="copyright" role="note">
				&copy; 2017-2020: <a href="https://devops.paulhammant.com/">Paul Hammant</a>. With Contributions <a href="../contributions/index.html">from friends</a>.
				Site built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				with
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme,
				via <a href="https://netlify.com/">Netlify</a>. &nbsp;
				<a href="https://github.com/paul-hammant/tbd/edit/master/content//_index.md">Contribute to this page</a>

			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="../release-from-trunk/index.html" title="Release from trunk">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Release from trunk
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="../branch-by-abstraction/index.html" title="Branch by Abstraction">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Branch by Abstraction
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/trunkbaseddevelopment.com\/';
      var repo_id  = 'paul-hammant\/tbd';
    
    </script>

    <script src="../javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }

      var showHideRefs = document.getElementById("showHideRefs");
      var refsElsewhereH1;
      var refsTable;
      if (showHideRefs) {
          refsElsewhereH1 = document.getElementById("references-elsewhere");
      }
      if (showHideRefs) {
          refsTable = refsElsewhereH1.nextElementSibling.nextElementSibling;
          hideRefs();
      }

      function hideRefs() {
          refsTable.style.display = "none";
          showHideRefs.innerHTML = "show references";
      }

      function toggleRefs() {
          if(refsTable.style.display == "block") {
              hideRefs();
          }
          else {
              refsTable.style.display = "block";
              showHideRefs.innerHTML = "hide references";
          }
      }


    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-24415524-3', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

