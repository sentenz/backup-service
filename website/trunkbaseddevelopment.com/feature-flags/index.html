<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Feature flags - Trunk Based Development</title>
    <meta name="generator" content="Hugo 0.85.0" />

    
    <meta name="description" content="A portal on this practice">
    
    <link rel="canonical" href="index.html">
    
    <meta name="author" content="paul-hammant">
    

    <meta property="og:url" content="https://trunkbaseddevelopment.com/feature-flags/">
    <meta property="og:title" content="Trunk Based Development">
    <meta property="og:image" content="https://trunkbaseddevelopment.com/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Trunk Based Development">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('../fonts/icon.eot');
        src: url('../fonts/icon.eot')
               format('embedded-opentype'),
             url('../fonts/icon.woff')
               format('woff'),
             url('../fonts/icon.ttf')
               format('truetype'),
             url('../fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="../stylesheets/application.css">
    <link rel="stylesheet" href="../stylesheets/temporary.css">
    <link rel="stylesheet" href="../stylesheets/palettes.css">
    <link rel="stylesheet" href="../stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="../javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-light-blue">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Trunk Based Development: Feature flags
      </div>
    </div>

    

        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <div class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../images/logo.png">
        </div>
      
      <div class="name">
        <strong>Trunk Based Development</strong>
      </div>
    </div>
  </div>

  <div class="scrollable">
    <div class="wrapper">
      <hr>

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Introduction" href="../index.html">
	
	Introduction
</a>



  
</li>



<li>
  
    



<a  title="Context" href="../context/index.html">
	
	Context
</a>



  
</li>



<li>
  
    



<a  title="Five-minute overview" href="../5-min-overview/index.html">
	
	Five-minute overview
</a>



  
</li>



<li>
  
    



<a  title="Deciding factors" href="../deciding-factors/index.html">
	
	Deciding factors
</a>



  
</li>



<li>
  
    



<a  title="Version control system features" href="../vcs-features/index.html">
	
	Version control system features
</a>



  
</li>



<li>
  
    



<a  title="Version control system choices" href="../vcs-choices/index.html">
	
	Version control system choices
</a>



  
</li>



<li>
  
    



<a class="current" title="Feature flags" href="index.html">
	
	Feature flags
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Branch by Abstraction" href="../branch-by-abstraction/index.html">
	
	Branch by Abstraction
</a>



  
</li>



<li>
  
    



<a  title="Branch for release" href="../branch-for-release/index.html">
	
	Branch for release
</a>



  
</li>



<li>
  
    



<a  title="Release from trunk" href="../release-from-trunk/index.html">
	
	Release from trunk
</a>



  
</li>



<li>
  
    



<a  title="Styles and Trade-offs" href="../styles/index.html">
	
	Styles and Trade-offs
</a>



  
</li>



<li>
  
    



<a  title="Continuous Integration (CI)" href="../continuous-integration/index.html">
	
	Continuous Integration (CI)
</a>



  
</li>



<li>
  
    



<a  title="Committing straight to the trunk" href="../committing-straight-to-the-trunk/index.html">
	
	Committing straight to the trunk
</a>



  
</li>



<li>
  
    



<a  title="Short Lived Feature Branches" href="../short-lived-feature-branches/index.html">
	
	Short Lived Feature Branches
</a>



  
</li>



<li>
  
    



<a  title="Continuous Code Review" href="../continuous-review/index.html">
	
	Continuous Code Review
</a>



  
</li>



<li>
  
    



<a  title="Continuous Delivery (CD)" href="../continuous-delivery/index.html">
	
	Continuous Delivery (CD)
</a>



  
</li>



<li>
  
    



<a  title="Concurrent development of consecutive releases" href="../concurrent-development-of-consecutive-releases/index.html">
	
	Concurrent development of consecutive releases
</a>



  
</li>



<li>
  
    



<a  title="Application strangulation" href="../strangulation/index.html">
	
	Application strangulation
</a>



  
</li>



<li>
  
    



<a  title="Observed habits" href="../observed-habits/index.html">
	
	Observed habits
</a>



  
</li>



<li>
  
    



<a  title="You&#39;re doing it wrong" href="../youre-doing-it-wrong/index.html">
	
	You&#39;re doing it wrong
</a>



  
</li>



<li>
  
    



<a  title="Alternative branching models" href="../alternative-branching-models/index.html">
	
	Alternative branching models
</a>



  
</li>



<li>
  
    



<a  title="Monorepos" href="../monorepos/index.html">
	
	Monorepos
</a>



  
</li>



<li>
  
    



<a  title="Expanding Contracting Monorepos" href="../expanding-contracting-monorepos/index.html">
	
	Expanding Contracting Monorepos
</a>



  
</li>



<li>
  
    



<a  title="Game Changers" href="../game-changers/index.html">
	
	Game Changers
</a>



  
</li>



<li>
  
    



<a  title="Publications" href="../publications/index.html">
	
	Publications
</a>



  
</li>



<li>
  
    



<a  title="Book on this topic" href="../book/index.html">
	
	Book on this topic
</a>



  
</li>



<li>
  
    



<a  title="Key to branch diagrams" href="../key/index.html">
	
	Key to branch diagrams
</a>



  
</li>



<li>
  
    



<a  title="Contributions" href="../contributions/index.html">
	
	Contributions
</a>



  
</li>


        </ul>
        

        
        <hr>

        <ul>

          <li>
            <a href="https://github.com/paul-hammant/tbd" target="_blank" title="See GitHub Repo">
              Site Source on Github
            </a>
          </li>

          <li>
            <a href="https://github.com/paul-hammant/tbd/commit/7f6c170e3760e5ae5cb49fca37b73cfea475581d" target="_blank">
              SHA-1 Published: 7f6c170e3760e5ae5cb49fca37b73cfea475581d
            </a>
          </li>
          </li>
<iframe id="buy" width='160' height='400' src='https://leanpub.com/trunk-based-development/embed' frameborder='0' allowtransparency='true'></iframe>
          <li>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1 style="color: white; padding: 32px 20px 72px; background-image:url(../images/LogoSlim.png); background-repeat: no-repeat; background-size: 100% auto"><span style="background-color: #5677fc">Feature flags </span></h1>

			<p>Feature Flags are a time-honored way to control the capabilities of an application or service in a large decisive way.</p>
<h3 id="an-example">An Example</h3>
<p>Say you have
an application or service that launches from the command-line that has a <code>main</code> method or function. Your feature flag
could be <code>--withOneClickPurchase</code> passed in as a command-line argument. That could activate lines of code in the app to
do with Amazon&rsquo;s patented one-click purchasing
experience.  Without that command-line argument, the application would run with a shopping cart component. At least
that&rsquo;s the way the developers coded that application. The &lsquo;One Click Purchase&rsquo; and &lsquo;Shopping Cart&rsquo; alternates are
probably also the same language that the business people associated with the project use. It gets complicated in
that flags need not be implicitly a/b or new/old, they could be additive. In our case here, there could also be a
<code>--allowUsersToUseShoppingCartInsteadOfOneClick</code> capability. Flags can be additive, you see.</p>
<div class="admonition note">
<p class="admonition-title">Flags Are Toggles</p>
<span>Industry Luminary, Martin Fowler, calls this technique &lsquo;Feature Toggles&rsquo;, and wrote a foundational definition (see refs below).
Feature Flags is in wider use by the industry, though, so we&rsquo;re going with that.</span>
</div>
<h2 id="granularity">Granularity</h2>
<p>It could be that the flag controls something large like the UI of a component. In our case above we could say that
<code>OneClickPurchasing</code> and <code>ShoppingCart</code> are the names of components.  It could be that the granularity of the flag
is much smaller - Say Americans want to see temperatures in degrees Fahrenheit and other nationalities would
prefer degrees Centigrade/Celsius. We could have a flag <code>--temp=F</code> and <code>--temp=C</code>. For fun, the developers also added
<code>--temp=K</code> (Kelvins).</p>
<h2 id="implementation">Implementation</h2>
<p>For the <code>OneClickPurchasing</code> and <code>ShoppingCart</code> alternates, it could be that a <code>PurchasingCompleting</code>
abstraction was created. Then at the most primordial boot place that&rsquo;s code controlled, the <code>--withOneClickPurchase</code> flag
is acted upon:</p>
<p>Java, by hand:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;--withOneClickPurchase&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  purchasingCompleting <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> OneClickPurchasing<span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Java Dependency Injection via config:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">bootContainer<span style="color:#f92672">.</span><span style="color:#a6e22e">addComponent</span><span style="color:#f92672">(</span>classFromName<span style="color:#f92672">(</span>config<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;purchasingCompleting&#34;</span><span style="color:#f92672">)));</span>
</code></pre></div><p>There are many more ways of passing flag intentions (or any config) to a runtime.  If you at all can, you want to
avoid if/else conditions in the code where a path choice would be made. Hence our emphasis on an abstraction.</p>
<h2 id="continuous-integration-pipelines">Continuous Integration pipelines</h2>
<p>It is important to have CI guard your reasonable expected permutations of flags. That means tests that happen on an
application or service after launching it, should also be adaptable and test what is meaningful for those flag
permutations. It also means that in terms of CI pipelines there is a fan-out <strong>after</strong> unit tests, for each meaningful
flag permutation. A crude equivalent is to run the whole CI pipeline in parallel for each meaningful flag permutation.
That would mean that each commit in the trunk kicks off more than one build - hopefully from elastic
infrastructure.</p>
<h2 id="runtime-switchable">Runtime switchable</h2>
<p>Sometimes flags set at app launch time is not enough. Say you are an Airline, selling tickets for flights online.
You might also rent out cars in conjunction with a partner - say &lsquo;Really Cool Rental Cars&rsquo; (RCRC). The connection to
any partner or their up/down status is outside your control, so you might want a switch in the software that works
without relaunch, to turn &ldquo;RCRC partner bookings&rdquo; on or off, and allow the 24/7 support team to flip it if certain &lsquo;Runbook&rsquo; conditions
have been met.  In this case, the end users may not notice if Hertz, Avis, Enterprise, etc are all still amongst
the offerings for that airport at the flight arrival time.</p>
<p>Key for Runtime switchable flags is the need for the state to persist. A restart of the application or service should
not set that flag choice back to default - it should retain the previous choice. It gets complicated when you think
about the need for the flag to permeate multiple nodes in a cluster of horizontally scaled sibling processes. For
that last, then holding the flag state in Consul<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://www.consul.io"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="../images/ext.png" alt=""></a></span>,
Etcd<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://github.com/coreos/etcd"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="../images/ext.png" alt=""></a></span> (or equivalent) is the modern way.</p>
<h2 id="build-flags">Build Flags</h2>
<p>Build flags affect the application or service as it is being built. With respect to the <code>--withOneClickPurchase</code> flag again,
the application would be incapable at runtime of having that capability if the build were not invoked with the suitable
flag somehow.</p>
<h2 id="ab-testing-and-betas">A/B testing and betas</h2>
<p>Pushing code that&rsquo;s turned off into production, allows you to turn it on for ephemeral reasons - you want a subset of
users to knowingly or unknowingly try it out. A/B testing (driven by marketing) is possible with runtime flags. So is
having beta versions of functionality/features available to groups.</p>
<h2 id="tech-debt---pitfall">Tech Debt - pitfall</h2>
<p>Flags get put into codebases over time and often get forgotten as development teams pivot towards new business deliverables.
Of course, you want to wait a while until it is certain that you are fixed on a toggle state, and that&rsquo;s where the
problem lies - the application works just fine with the toggle left in place, and the business only really cares
about new priorities. The only saving grace is the fact that you had unit tests for everything, even for code that
is effectively turned off in production. Try to get the business to allow the remediation of flags (and the code
they apply to) a month after the release. Maybe add them to the project&rsquo;s readme with a &ldquo;review for delete&rdquo; date.</p>
<h2 id="history">History</h2>
<p>Some historical predecessors of feature toggles/flags as we know it today:</p>
<ul>
<li>Unified Versioning through Feature Logic (Andreas Zeller and Gregor Snelting, 1996)<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="http://www.cs.tufts.edu/~nr/cs257/archive/andreas-zeller/tr-96-01.pdf"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="../images/ext.png" alt=""></a></span> - white paper.</li>
<li>Configuration Management with Version Sets: A Unified Software Versioning Model and its Applications (Andreas Zeller&rsquo;s, 1997)<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="https://www.st.cs.uni-saarland.de/publications/files/zeller-thesis-1997.pdf"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="../images/ext.png" alt=""></a></span> - Ph.D. thesis.</li>
</ul>
<p>There&rsquo;s a warning too:</p>
<ul>
<li>&ldquo;#ifdef considered harmful&rdquo; (Henry Spencer and Geoff Collyer, 1992)<span class="rref"><a class="inline-ref" style="border-bottom: 0" target="_blank" href="http://www.literateprogramming.com/ifdefs.pdf"><img style="padding: 0 0 0 3px; width: 16px; height: 14px" src="../images/ext.png" alt=""></a></span> - white paper.</li>
</ul>
<p>Brad Appleton says:</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->â€œ<!-- raw HTML omitted -->
The thing I do not like about feature-toggles/flags is when they end up NOT being short-lived as intended,
and we end up having to revisit Spencer and Collyer&rsquo;s famous paper. The funny thing is feature-branches
started out the same way. When they were first introduced it was for feature-teams using very large features, and the
purpose of the separate branches was because too many people were trying to commit at the same time to the same branch.
So the idea was use separate branches (for scale) and teams would integrate to their team-branch daily or more often
WITH at least nightly integration across all feature-branches [sigh].</p>
<!-- raw HTML omitted -->
<h1 id="references-elsewhere">References elsewhere</h1>
<p><!-- raw HTML omitted -->show references<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->


			<aside class="copyright" role="note">
				&copy; 2017-2020: <a href="https://devops.paulhammant.com/">Paul Hammant</a>. With Contributions <a href="../contributions/index.html">from friends</a>.
				Site built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				with
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme,
				via <a href="https://netlify.com/">Netlify</a>. &nbsp;
				<a href="https://github.com/paul-hammant/tbd/edit/master/content//_index.md">Contribute to this page</a>

			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="../branch-by-abstraction/index.html" title="Branch by Abstraction">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Branch by Abstraction
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="../vcs-choices/index.html" title="Version control system choices">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Version control system choices
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/trunkbaseddevelopment.com\/';
      var repo_id  = 'paul-hammant\/tbd';
    
    </script>

    <script src="../javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }

      var showHideRefs = document.getElementById("showHideRefs");
      var refsElsewhereH1;
      var refsTable;
      if (showHideRefs) {
          refsElsewhereH1 = document.getElementById("references-elsewhere");
      }
      if (showHideRefs) {
          refsTable = refsElsewhereH1.nextElementSibling.nextElementSibling;
          hideRefs();
      }

      function hideRefs() {
          refsTable.style.display = "none";
          showHideRefs.innerHTML = "show references";
      }

      function toggleRefs() {
          if(refsTable.style.display == "block") {
              hideRefs();
          }
          else {
              refsTable.style.display = "block";
              showHideRefs.innerHTML = "hide references";
          }
      }


    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-24415524-3', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

